Ext.namespace("MODx.form");MODx.form.Handler=function(A){A=A||{};MODx.form.Handler.superclass.constructor.call(this,A)};Ext.extend(MODx.form.Handler,Ext.Component,{fields:[],send:function(E,A,D,C){var B=Ext.get(E);this.unhighlightFields();Ext.Ajax.request({url:B.dom.action+"?action="+A,params:Ext.Ajax.serializeForm(E),method:"post",scope:C||this,callback:D==null?this.handle:D});return false},handle:function(C,A,B){B=Ext.decode(B.responseText);if(!B.success){this.showError(B.message);return false}return true},highlightField:function(B){if(B.id!="undefined"&&B.id!="forEach"&&B.id!=""){Ext.get(B.id).dom.style.border="1px solid red";var A=Ext.get(B.id+"_error");if(A){A.innerHTML=B.msg}this.fields.push(B.id)}},unhighlightFields:function(){for(var B=0;B<this.fields.length;B++){Ext.get(this.fields[B]).dom.style.border="";var A=Ext.get(this.fields[B]+"_error");if(A){A.innerHTML=""}}this.fields=[]},errorJSON:function(B){if(B==""){return this.showError(B)}if(B.data!=null){for(var A=0;A<B.data.length;A++){this.highlightField(B.data[A])}}this.showError(B.message);return false},errorExt:function(A,B){this.unhighlightFields();if(A.errors!=null&&B){B.markInvalid(A.errors)}if(A.message!=undefined&&A.message!=""){this.showError(A.message)}else{MODx.msg.hide()}return false},unescapeJson:function(C){for(var D in C){if($type(C[D])=="object"){for(var B in C[D]){C[D][B]=unescape(C[D][B])}}else{if($type(C[D])=="string"){C[D]=unescape(C[D])}else{if($type(C[D])=="array"){for(var A=0;A<C[D].length;A++){for(var B in C[D][A]){C[D][A]=this.unescapeJson(C[D][A])}}}}}}return C},showError:function(A){A==""?MODx.msg.hide():MODx.msg.alert(_("error"),A,function(){})},closeError:function(){MODx.msg.hide()}});Ext.reg("modx-form-handler",MODx.form.Handler);