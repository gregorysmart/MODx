MODx.toolbar.ActionButtons=function(A){A=A||{};MODx.toolbar.ActionButtons.superclass.constructor.call(this,A);this.id=id;Ext.applyIf(A,{actions:{close:MODx.action.welcome},params:{}});if(A.loadStay==true){if(!A.items){A.items=[]}A.items.push(this.getStayMenu())}this.config=A;this.render("modAB")};Ext.extend(MODx.toolbar.ActionButtons,Ext.Toolbar,{id:"",buttons:[],options:{a_close:"welcome"},stay:"stay",create:function(){var a=arguments,l=a.length;for(var i=0;i<l;i++){var options=a[i];if(options=="-"){this.add(this,"-");continue}Ext.applyIf(options,{xtype:"button"});if(options.icon){options.cls="x-btn-icon bmenu"}if(options.button){this.add(this,options);continue}Ext.applyIf(options,{cls:"x-btn-text bmenu",scope:this});if(options.handler==null&&options.menu==null){options.handler=this.checkConfirm}else{if(options.handler){if(options.confirm){var f=options.handler;var c=options.confirm;var s=options.scope||this;options.handler=function(){Ext.Msg.confirm(_("warning"),c,function(e){if(e=="yes"){Ext.callback(f,this)}},s)}}}}var b=new Ext.Toolbar.Button(options);if(options.javascript){b.addListener("click",function(itm,e){if(!eval(itm.javascript)){e.stopEvent();e.preventDefault()}},this)}this.add(this,b);if(options.keys){var map=new Ext.KeyMap(Ext.get(document));var c=options.keys.length;for(var i=0;i<c;i++){var k=options.keys[i];Ext.applyIf(k,{scope:this,stopEvent:true,fn:function(e){this.checkConfirm(b,e)}});map.addBinding(k)}}}return false},checkConfirm:function(B,A){if(B.confirm!=null){this.confirm(B,function(){this.handleClick(B,A)},this)}else{this.handleClick(B,A)}return false},confirm:function(C,B,A){if(C.confirm==null){return true}Ext.Msg.confirm("",C.confirm,function(D){if(D=="yes"){if(B==null){return true}if(typeof (B)=="function"){Ext.callback(B,A||this,[C])}else{location.href=B}}},this)},checkOnComplete:function(B,C,A){if(C.hasListener("success")&&A.success){C.fireEvent("success",{r:A})}if(C.onComplete){Ext.callback(C.onComplete,C.onCompleteScope||this,[B,C,A]);if(C.reload){Ext.callback(this.reloadPage,this,[],1000)}Ext.Msg.hide();Ext.callback(this.redirectStay,this,[B,C,A],1000);return false}else{this.redirectStay(B,C,A)}},reloadPage:function(){location.href=location.href},handleClick:function(E,A){var C=this.config;switch(E.method){case"remote":MODx.util.Progress.reset();Ext.Msg.show({title:_("please_wait"),msg:_("saving"),width:240,progress:true,closable:false});if(C.formpanel!=undefined&&C.formpanel!=""&&C.formpanel!=null){C.form=Ext.getCmp(C.formpanel).getForm()}if(C.form!=undefined){if(C.form.isValid()){Ext.applyIf(C.params,{action:E.process,"modx-ab-stay":MODx.config.stay});C.form.submit({params:C.params,reset:false,scope:this,failure:function(G,F){MODx.form.Handler.errorExt(F.result,G)},success:function(G,F){MODx.util.Progress.time(5,MODx.util.Progress.id,_("refreshing_tree"));if(F.result.message!=""&&!E.onComplete){Ext.Msg.alert(_("success"),F.result.message,function(){if(this.checkOnComplete(C,E,F.result)){C.refreshTree?C.refreshTree.refresh():parent.Ext.get("modx_document_tree").refresh()}},this)}else{if(this.checkOnComplete(C,E,F.result)){C.refreshTree?C.refreshTree.refresh():parent.Ext.get("modx_document_tree").refresh()}}}})}else{Ext.Msg.alert(_("error"),_("correct_errors"))}}else{MODx.form.Handler.send(C.form_id,E.process,function(F,G,H){H=Ext.decode(H.responseText);if(H.success){MODx.util.Progress.time(5,MODx.util.Progress.id,_("refreshing_tree"));C.refreshTree?C.refreshTree.refresh():parent.Ext.get("modx_document_tree").refresh();this.checkOnComplete(C,E,H)}else{MODx.form.Handler.errorJSON(H)}},this)}break;default:var D=C.id||0;Ext.applyIf(E.params||{},C.baseParams||{});var B="index.php?id="+D+"&"+Ext.urlEncode(E.params);location.href=B;break}return false},checkStay:function(B,A){this.stay=B.value},redirectStay:function(C,D,B){C=this.config;Ext.applyIf(D.params||{},C.baseParams);var A=Ext.urlEncode(D.params);switch(MODx.config.stay){case"new":location.href="index.php?a="+C.actions["new"]+"&"+A;break;case"stay":if((D.process=="create"||D.process=="duplicate"||D.reload)&&B.object.id!=null){location.href="index.php?a="+C.actions.edit+"&id="+B.object.id+"&"+A}else{if(D.process=="delete"){location.href="index.php?a="+C.actions.cancel+"&"+A}else{Ext.Msg.hide()}}break;case"close":location.href="index.php?a="+C.actions.cancel+"&"+A;break}},loadStay:function(){this.add("-",this.getStayMenu()," "," "," ")},getStayMenu:function(){return{xtype:"switch",id:"stayMenu",activeItem:MODx.config.stay=="new"?0:1,items:[{tooltip:_("stay_new"),value:"new",menuIndex:0,iconCls:"icon-list-new"},{tooltip:_("stay"),value:"stay",menuIndex:1,iconCls:"icon-mark-active"},{tooltip:_("close"),value:"close",menuIndex:2,iconCls:"icon-mark-complete"}],listeners:{change:function(A,B){MODx.config.stay=B.value},scope:this,delay:10}}},refreshTreeNode:function(A,D,B){var C=parent.Ext.getCmp(A);C.refreshNode(D,B||false);return false}});Ext.reg("modx-actionbuttons",MODx.toolbar.ActionButtons);