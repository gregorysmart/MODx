MODx.tree.Document=function(A){A=A||{};Ext.applyIf(A,{rootVisible:false,expandFirst:true,enableDrag:true,enableDrop:true,sortBy:"menuindex",title:"",remoteToolbar:true,url:MODx.config.connectors_url+"layout/tree/document.php"});MODx.tree.Document.superclass.constructor.call(this,A);if(A.el){var B=Ext.get(A.el);B.createChild({tag:"div",id:"modx_doctree_tb"});B.createChild({tag:"div",id:"modx_doctree_filter"})}};Ext.extend(MODx.tree.Document,MODx.tree.Tree,{forms:{},windows:{},stores:{},_initExpand:function(){var A=Ext.state.Manager.get(this.treestate_id);if(A==undefined){if(this.root){this.root.expand()}var B=this.getNodeById("web_0");if(B&&this.config.expandFirst){B.select();B.expand()}}else{this.expandPath(A)}},duplicateResource:function(C,D){var B=this.cm.activeNode;var E=B.id.split("_");E=E[1];var A={resource:E,is_folder:B.getUI().hasClass("folder")};if(this.windows.duplicate){this.windows.duplicate.destroy()}this.windows.duplicate=new MODx.window.DuplicateResource({resource:E,is_folder:B.getUI().hasClass("folder"),scope:this,success:this.refreshParentNode});this.windows.duplicate.setValues(A);this.windows.duplicate.show(D.target)},preview:function(B,C){var A=this.cm.activeNode;var D=A.id.split("_");D=D[1];window.open(MODx.config.base_url+"index.php?id="+D)},deleteDocument:function(B,C){var A=this.cm.activeNode;var D=A.id.split("_");D=D[1];MODx.msg.confirm({title:_("delete_document"),text:_("confirm_delete_document"),connector:MODx.config.connectors_url+"resource/document.php",params:{action:"delete",id:D},scope:this,success:this.refreshParentNode})},undeleteDocument:function(B,C){var A=this.cm.activeNode;var D=A.id.split("_");D=D[1];Ext.Ajax.request({url:MODx.config.connectors_url+"resource/document.php",params:{action:"undelete",id:D},scope:this,success:function(E,F){E=Ext.decode(E.responseText);E.success?this.refreshParentNode():MODx.form.Handler.errorJSON(E)}})},publishDocument:function(B,C){var A=this.cm.activeNode;var D=A.id.split("_");D=D[1];MODx.msg.confirm({title:_("publish_document"),text:_("confirm_publish"),connector:MODx.config.connectors_url+"resource/document.php",params:{action:"publish",id:D},scope:this,success:this.refreshParentNode})},unpublishDocument:function(B,C){var A=this.cm.activeNode;var D=A.id.split("_");D=D[1];MODx.msg.confirm({title:_("unpublish_document"),text:_("confirm_unpublish"),connector:MODx.config.connectors_url+"resource/document.php",params:{action:"unpublish",id:D},scope:this,success:this.refreshParentNode})},emptyRecycleBin:function(A,B){Ext.Ajax.request({url:MODx.config.connectors_url+"resource/document.php",params:{action:"emptyRecycleBin"},scope:this,success:function(C,D){C=Ext.decode(C.responseText);C.success?this.refresh():MODx.form.Handler.errorJSON(C)}})},showFilter:function(F,E){if(this._filterVisible){return false}var C=Ext.get("modx_doctree_filter");var D=C.createChild({tag:"div"});var B=new Ext.Toolbar(D);var A=new Ext.form.ComboBox({store:new Ext.data.SimpleStore({fields:["name","value"],data:[[_("menu_order"),"menuindex"],[_("page_title"),"pagetitle"],[_("publish_date"),"pub_date"],[_("createdon"),"createdon"],[_("editedon"),"editedon"]]}),displayField:"name",valueField:"value",editable:false,mode:"local",triggerAction:"all",selectOnFocus:false,width:100,value:this.config.sortBy,listeners:{select:{fn:this.filterSort,scope:this}}});B.add(_("sort_by")+":");B.addField(A);B.add("-",{scope:this,cls:"x-btn-icon",icon:MODx.config.template_url+"images/icons/close.gif",handler:this.hideFilter});this.filterBar=B;this._filterVisible=true},filterSort:function(A,C,B){this.config.sortBy=A.getValue();this.getLoader().baseParams={action:this.config.action,sortBy:this.config.sortBy};this.refresh()},hideFilter:function(B,A){this.filterBar.destroy();this._filterVisible=false}});Ext.reg("tree-document",MODx.tree.Document);