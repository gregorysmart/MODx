MODx.grid.AccessResourceGroup=function(A){A=A||{};Ext.applyIf(A,{title:_("ugrg_grid_title"),url:MODx.config.connectors_url+"security/access/index.php",baseParams:{action:"getList",type:A.type||"modAccessResourceGroup"},fields:["id","target","target_name","principal_class","principal","principal_name","authority","policy","policy_name","context_key","menu"],type:"modAccessResourceGroup",paging:true,columns:[{header:_("id"),dataIndex:"id",width:40},{header:_("resource_group_id"),dataIndex:"target",width:40},{header:_("resource_group"),dataIndex:"target_name",width:150},{header:_("user_group_id"),dataIndex:"principal",width:40},{header:_("user_group"),dataIndex:"principal_name",width:150},{header:_("authority"),dataIndex:"authority",width:75},{header:_("policy"),dataIndex:"policy_name",width:175},{header:_("context"),dataIndex:"context_key",width:60}],tbar:this.getToolbar()});MODx.grid.AccessResourceGroup.superclass.constructor.call(this,A)};Ext.extend(MODx.grid.AccessResourceGroup,MODx.grid.Grid,{windows:{},combos:{},createArg:function(A,C){var B=this.menu.record;if(!this.windows.create_arg){this.windows.create_arg=new MODx.window.AccessResourceGroup({scope:this,success:function(E,D){var F=D.result.object;this.getStore().baseParams={action:"getList",type:this.config.type,target:this.combos.rg.getValue(),principal:this.combos.rg.getValue(),principal_class:"modUserGroup"};this.refresh()},record:B})}else{this.windows.create_arg.setValues(B)}this.windows.create_arg.show(C.target)},editAcl:function(C,B){var A=this.menu.record;if(!this.windows.update_arg){this.windows.update_arg=new MODx.window.AccessResourceGroup({id:A.id,scope:this,success:this.refresh,record:A})}else{this.windows.update_arg.setValues(A)}this.windows.update_arg.show(B.target)},removeAcl:function(B,A){MODx.msg.confirm({title:_("ugrg_remove"),text:_("access_confirm_remove"),connector:this.config.url,params:{action:"removeAcl",id:this.menu.record.id,type:this.config.type},scope:this,success:this.refresh})},clearFilter:function(A,B){this.getStore().baseParams={action:"getList",type:this.config.type,target:"",principal:"",principal_class:"modUserGroup"};this.combos.ug.setValue("");this.combos.rg.setValue("");this.getStore().load()},getToolbar:function(){this.combos.ug=new MODx.combo.UserGroup();this.combos.ug.on("select",function(A,B){this.getStore().baseParams={action:"getList",type:this.config.type,target:this.combos.rg.getValue(),principal:this.combos.ug.getValue()};this.getStore().reload()},this);this.combos.rg=new MODx.combo.ResourceGroup();this.combos.rg.on("select",function(A,B){this.getStore().baseParams={action:"getList",type:this.config.type,target:this.combos.rg.getValue(),principal:this.combos.ug.getValue()};this.getStore().reload()},this);return[_("resource_group")+": ",this.combos.rg,"-",_("user_group")+": ",this.combos.ug,"-",{text:_("clear_filter"),scope:this,handler:this.clearFilter},"->",{text:_("add"),scope:this,handler:this.createArg}]}});Ext.reg("grid-accessresourcegroup",MODx.grid.AccessResourceGroup);MODx.window.AccessResourceGroup=function(A){A=A||{};Ext.applyIf(A,{title:_("ugrg_mutate"),autoHeight:true,width:350,type:"modAccessResourceGroup",id:0});MODx.window.AccessResourceGroup.superclass.constructor.call(this,A)};Ext.extend(MODx.window.AccessResourceGroup,MODx.Window,{combos:{},_loadForm:function(){if(this.checkIfLoaded(this.config.record)){return false}if(this.config.id){Ext.Ajax.request({url:MODx.config.connectors_url+"security/access/index.php",params:{action:"getAcl",id:this.config.id,type:this.config.type},scope:this,success:this.prepareForm})}else{this.prepareForm(null,null)}},prepareForm:function(A){var B={};if(A){A=Ext.decode(A.responseText);if(A.success){B=A.object;this.config.baseParams={action:"updateAcl",type:this.options.type}}}this.options.values=B;this.fp=this.createForm({url:this.config.connector||MODx.config.connectors_url+"security/access/index.php",baseParams:this.config.baseParams||{action:"addAcl",type:this.config.type},items:[{fieldLabel:_("resource_group"),name:"target",hiddenName:"target",xtype:"combo-resourcegroup",value:B.target},{fieldLabel:_("user_group"),name:"principal",hiddenName:"principal",xtype:"combo-usergroup",value:B.principal||"",baseParams:{action:"getList",combo:"1"}},{fieldLabel:_("authority"),name:"authority",xtype:"textfield",width:40,value:B.authority},{fieldLabel:_("policy"),name:"policy",hiddenName:"policy",xtype:"combo-policy",value:B.policy||"",baseParams:{action:"getList",combo:"1"}},{fieldLabel:_("context"),name:"context_key",hiddenName:"context_key",xtype:"combo-context",value:B.context_key||""},{name:"principal_class",xtype:"hidden",value:"modUserGroup"},{name:"id",xtype:"hidden",value:B.id}]});this.renderForm()}});Ext.reg("window-access-resourcegroup",MODx.window.AccessResourceGroup);