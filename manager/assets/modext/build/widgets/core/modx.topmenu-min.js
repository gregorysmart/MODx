MODx.toolbar.TopMenu=function(A){A=A||{};Ext.applyIf(A,{id:"modx-topmenu",renderTo:"modx_tm"});MODx.toolbar.TopMenu.superclass.constructor.call(this,A);this.config=A;this.init()};Ext.extend(MODx.toolbar.TopMenu,Ext.Toolbar,{menus:{},init:function(){Ext.Ajax.request({url:MODx.config.connectors_url+"system/menu.php",params:{action:"getMenu"},scope:this,success:function(A,B){A=Ext.decode(A.responseText);if(A.success){this._loadMenus(A.object)}}})},_loadMenus:function(G){for(var E=0;E<G.length;E++){var A=G[E];var D=_(A.text);if(D==undefined||D==""){D=A.text}this.addMenu({id:"mi_"+A.id,icon:MODx.config.template_url+A.icon,text:D});if(A.children.length>0){for(var B=0;B<A.children.length;B++){var F=A.children[B];if(F.text=="-"){var C="-"}else{var D=_(F.text);if(D==undefined||D==""){D=F.text}var C={text:D};if(F.icon!=""){C.icon=MODx.config.template_url+F.icon}if(F.handler!=""){C.handler=new Function("itm","e",""+F.handler+"; return false;");C.href="javascript:;"}else{C.action=F.action+F.params}}this.addMenuItem("mi_"+A.id,C)}}}this.addMenu("->",MODx.config.version)},handleClick:function(B,A){A.preventDefault();A.stopPropagation();Ext.get("modx_content").dom.src="?a="+B.action},addMenu:function(){var B=arguments,A=B.length;for(var D=0;D<A;D++){var C=B[D];if(typeof (C)=="string"&&C!="-"&&C!="->"&&C!="<-"){C={text:C}}else{this.menus[C.id]=new Ext.menu.Menu({id:C.id,items:[]});Ext.apply(C,{cls:"x-btn-text-icon bmenu",menu:this.menus[C.id]})}this.add(C)}},addMenuItem:function(F){var B=arguments,A=B.length;for(var E=1;E<A;E++){var D=B[E];var C;if(D=="-"){C="-"}else{Ext.applyIf(D,{href:"index.php?a="+(D.action||3),scope:this,handler:this.handleClick});C=new Ext.menu.Item(D)}this.menus[F].add(C)}}});Ext.reg("modx-topmenu",MODx.toolbar.TopMenu);