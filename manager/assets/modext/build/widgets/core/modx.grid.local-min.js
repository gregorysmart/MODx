Ext.namespace("MODx.grid");MODx.grid.LocalGrid=function(A){A=A||{};if(A.grouping){Ext.applyIf(A,{view:new Ext.grid.GroupingView({forceFit:true,groupTextTpl:'{text} ({[values.rs.length]} {[values.rs.length > 1 ? "'+(A.pluralText||_("records"))+'" : "'+(A.singleText||_("record"))+'"]})'})})}if(A.tbar){for(var B=0;B<A.tbar.length;B++){var C=A.tbar[B];if(C.handler&&typeof (C.handler)=="object"&&C.handler.xtype){C.handler=this.loadWindow.createDelegate(this,[C.handler],true)}if(!C.scope){C.scope=this}}}Ext.applyIf(A,{title:"",store:new Ext.data.SimpleStore({fields:A.fields,data:A.data||[]}),sm:new Ext.grid.RowSelectionModel({singleSelect:false}),loadMask:true,loadMask:true,autoHeight:true,collapsible:true,stripeRows:true,viewConfig:{forceFit:true,enableRowBody:true,autoFill:true,showPreview:true},listeners:{rowcontextmenu:{fn:this._showMenu,scope:this}},tools:[{id:"help",qtip:_("help"),handler:this.help,scope:this}]});this.menu=new Ext.menu.Menu({defaultAlign:"tl-b?"});MODx.grid.LocalGrid.superclass.constructor.call(this,A)};Ext.extend(MODx.grid.LocalGrid,Ext.grid.EditorGridPanel,{windows:{},loadWindow:function(A,E,D,C){var B=this.menu.record;if(!this.windows[D.xtype]){Ext.applyIf(D,{scope:this,success:this.refresh,record:D.blankValues?{}:B});if(C){Ext.apply(D,C)}this.windows[D.xtype]=Ext.ComponentMgr.create(D)}if(this.windows[D.xtype].setValues&&D.blankValues!==true){this.windows[D.xtype].setValues(B)}this.windows[D.xtype].show(E.target)},_showMenu:function(C,B,D){D.stopEvent();D.preventDefault();this.menu.record=this.getStore().getAt(B).data;if(!this.getSelectionModel().isSelected(B)){this.getSelectionModel().selectRow(B)}this.menu.removeAll();var A=this.getMenu();if(A){this.addContextMenuItem(A);this.menu.show(D.target)}},getMenu:function(){return this.menu.record.menu},addContextMenuItem:function(items){var a=items,l=a.length;for(var i=0;i<l;i++){var options=a[i];if(options=="-"){this.menu.add("-");continue}if(options.handler){var h=eval(options.handler);if(h&&typeof (h)=="object"&&h.xtype){h=this.loadWindow.createDelegate(this,[h],true)}}else{var h=function(itm,e){var o=itm.options;var id=this.menu.record.id;var w=Ext.get("modx_content");if(o.confirm){Ext.Msg.confirm("",o.confirm,function(e){if(e=="yes"){var a=Ext.urlEncode(o.params||{action:o.action});var s="index.php?id="+id+"&"+a;if(w==null){location.href=s}else{w.dom.src=s}}},this)}else{var a=Ext.urlEncode(o.params||{action:o.action});var s="index.php?id="+id+"&"+a;if(w==null){location.href=s}else{w.dom.src=s}}}}this.menu.add({id:options.id||Ext.id(),text:options.text,scope:this,options:options,handler:h})}},remove:function(A){Ext.Msg.confirm(A.title||"",A.text||"",function(C){if(C=="yes"){var B=this.getSelectionModel().getSelected();this.getStore().remove(B)}},this)}});Ext.reg("grid-local",MODx.grid.LocalGrid);