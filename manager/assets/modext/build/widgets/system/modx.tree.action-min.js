MODx.tree.Action=function(A){A=A||{};Ext.applyIf(A,{root_id:"n_root_0",root_name:_("actions"),title:_("actions"),rootVisible:true,expandFirst:true,enableDrag:true,enableDrop:true,ddAppendOnly:true,url:MODx.config.connectors_url+"system/action.php",action:"getNodes"});MODx.tree.Action.superclass.constructor.call(this,A)};Ext.extend(MODx.tree.Action,MODx.tree.Tree,{windows:{},create:function(A,B){var A=this.cm.activeNode;var C=A.id.split("_");C=C[1]=="context"?0:C[2];Ext.Ajax.request({url:this.config.url,params:{action:"get",id:C},scope:this,success:function(D,E){D=Ext.decode(D.responseText);Ext.apply(D.object,{parent:D.object.id});if(!this.windows.create_action){this.windows.create_action=MODx.load({xtype:"window-action-create",scope:this,success:this.refresh,record:D.object})}else{this.windows.create_action.setValues(D.object)}this.windows.create_action.show(B.target)}})},update:function(A,B){var A=this.cm.activeNode;var C=A.id.split("_");C=C[2];Ext.Ajax.request({url:this.config.url,params:{action:"get",id:C},scope:this,success:function(D,E){D=Ext.decode(D.responseText);Ext.applyIf(D.object,{parent:D.object.id,parent_controller:D.object.controller,loadheaders:D.object.haslayout});if(!this.windows.update_action){this.windows.update_action=MODx.load({xtype:"window-action-update",scope:this,success:this.refresh,record:D.object})}else{this.windows.update_action.setValues(D.object)}this.windows.update_action.show(B.target)}})},remove:function(A,B){var A=this.cm.activeNode;var C=A.id.split("_");C=C[2];MODx.msg.confirm({title:_("warning"),text:_("action_confirm_remove"),url:this.config.url,params:{action:"remove",id:C},scope:this,success:this.refresh})}});Ext.reg("tree-action",MODx.tree.Action);MODx.window.CreateAction=function(A){A=A||{};Ext.applyIf(A,{title:_("action_create"),width:430,url:MODx.config.connectors_url+"system/action.php",action:"create",fields:[{fieldLabel:_("controller"),name:"controller",xtype:"textfield",width:200},{fieldLabel:_("context"),name:"context_key",xtype:"combo-context",width:150,allowBlank:false,value:"mgr"},{fieldLabel:_("controller_parent"),name:"parent",hiddenName:"parent",xtype:"combo-action",width:200},{fieldLabel:_("load_headers"),name:"loadheaders",xtype:"checkbox",checked:true},{fieldLabel:_("lang_foci"),description:_("lang_foci_desc"),name:"lang_foci",xtype:"textfield",width:200},{fieldLabel:_("assets"),name:"assets",xtype:"textarea",width:200,grow:false}]});MODx.window.CreateAction.superclass.constructor.call(this,A)};Ext.extend(MODx.window.CreateAction,MODx.Window);Ext.reg("window-action-create",MODx.window.CreateAction);MODx.window.UpdateAction=function(A){A=A||{};Ext.applyIf(A,{title:_("action_update"),width:430,url:MODx.config.connectors_url+"system/action.php",action:"update",fields:[{name:"id",xtype:"hidden"},{name:"parent",xtype:"hidden"},{fieldLabel:_("controller"),name:"controller",xtype:"textfield",width:200},{fieldLabel:_("context"),name:"context_key",hiddenName:"context_key",xtype:"combo-context",width:150,allowBlank:false},{fieldLabel:_("controller_parent"),name:"parent_controller",hiddenName:"parent_controller",xtype:"combo-action",readOnly:true,width:200},{fieldLabel:_("load_headers"),name:"loadheaders",xtype:"checkbox",checked:true},{fieldLabel:_("lang_foci"),description:_("lang_foci_desc"),name:"lang_foci",xtype:"textfield",width:200},{fieldLabel:_("assets"),name:"assets",xtype:"textarea",width:200,grow:false}]});MODx.window.UpdateAction.superclass.constructor.call(this,A)};Ext.extend(MODx.window.UpdateAction,MODx.Window);Ext.reg("window-action-update",MODx.window.UpdateAction);MODx.combo.Action=function(A){A=A||{};Ext.applyIf(A,{name:"action",hiddenName:"action",displayField:"controller",valueField:"id",fields:["id","controller"],url:MODx.config.connectors_url+"system/action/index.php"});MODx.combo.Action.superclass.constructor.call(this,A)};Ext.extend(MODx.combo.Action,MODx.combo.ComboBox);Ext.reg("combo-action",MODx.combo.Action);